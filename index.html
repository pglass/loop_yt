<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>LoopYT by pglass</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>LoopYT</h1>
        <p>A redirectless bookmarklet for looping YouTube videos</p>

        <p class="view"><a href="https://github.com/pglass/loop_yt">View the Project on GitHub <small>pglass/loop_yt</small></a></p>


        <ul>
          <li><a href="https://github.com/pglass/loop_yt/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/pglass/loop_yt/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/pglass/loop_yt">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <p>This is a redirectless bookmarklet for looping YouTube videos. This should work for both the Flash and HTML5 versions of YouTube.</p>

<p><strong>How to use it</strong>: Drag the <a href="javascript:%28function%28%29%7Bif%28typeof%20_loop_yt_interval_id%21%3D%3Dtypeof%20undefined%29%7BclearInterval%28_loop_yt_interval_id%29%3B%7D%0A_loop_yt_interval_id%3Dnull%3Bvar%20YT_PLAYER_STATES%3D%7Bunstarted%3A-1%2Cended%3A0%2Cplaying%3A1%2Cpaused%3A2%2Cbuffering%3A3%2Ccued%3A5%2C%7D%3Bfunction%20detect_video_type%28%29%7Bvar%20check%3Ddocument.getElementsByTagName%28%22video%22%29%3Bif%28check.length%21%3D%3D0%29%7Breturn%7Bplayer_type%3A%22html5%22%2Cplayer%3Acheck%5B0%5D%7D%3B%7D%0Acheck%3Ddocument.getElementById%28%22movie_player%22%29%3Bif%28check%21%3D%3Dnull%29%7Breturn%7Bplayer_type%3A%22flash%22%2Cplayer%3Acheck%7D%3B%7D%0Areturn%7Bplayer_type%3Anull%2Cplayer%3Anull%7D%3B%7D%0Afunction%20handle_html5%28yp%29%7Byp.play%28%29%3Byp.loop%3Dtrue%3B%7D%0Afunction%20video_id_from_url%28url%29%7Bif%28typeof%20url%21%3D%3Dtypeof%22%22%29%7Breturn%20null%3B%7D%0Avar%20parts%3Durl.split%28%27v%3D%27%29%3Bif%28parts.length%21%3D%3D2%29%7Breturn%20null%3B%7D%0Avar%20subparts%3Dparts%5B1%5D.split%28%27%26%27%29%3Breturn%20subparts%5B0%5D%3B%7D%0Afunction%20handle_flash%28yp%29%7Bvar%20url%3Dyp.getVideoUrl%28%29%3Bvar%20video_id%3Dvideo_id_from_url%28url%29%3Bif%28video_id%3D%3D%3Dnull%29%7Bconsole.log%28%22Failed%20to%20parse%20video%20id%20from%20url%22%29%3Breturn%3B%7D%0A_loop_yt_interval_id%3DsetInterval%28function%28%29%7Bvar%20state%3Dyp.getPlayerState%28%29%3Bif%28state%3D%3D%3DYT_PLAYER_STATES.ended%29%7Byp.loadVideoById%28video_id%2C0%29%3B%7D%7D%2C1000%29%3Bvar%20state%3Dyp.getPlayerState%28%29%3Bif%28state%3D%3D%3DYT_PLAYER_STATES.ended%7C%7Cstate%3D%3DYT_PLAYER_STATES.paused%7C%7Cstate%3D%3DYT_PLAYER_STATES.unstarted%29%7Byp.playVideo%28%29%3B%7D%7D%0Afunction%20set_loop%28%29%7Bvar%20result%3Ddetect_video_type%28%29%3Bif%28result.player_type%3D%3D%3D%22html5%22%29%7Bconsole.log%28%22found%20html5%22%29%3Bconsole.log%28result.player%29%3Bhandle_html5%28result.player%29%3B%7Delse%20if%28result.player_type%3D%3D%3D%22flash%22%29%7Bhandle_flash%28result.player%29%3B%7Delse%7Bconsole.log%28%22Unable%20to%20find%20a%20video%20element%22%29%3B%7D%7D%0Aconsole.log%28%22Running%20LoopYT%22%29%3Bset_loop%28%29%3B%7D%29%28%29%3B">LoopYT</a> bookmarklet to your bookmarks. When you're on a YouTube video page, click the bookmarklet. The video should then repeat indefinitely. If the video is stopped, the script will play the video.</p>

<p><strong>Why</strong>: Other bookmarklets that I've found for looping a YouTube video will send you to another website like <a href="http://youtubeonrepeat.com/">youtubeonrepeat.com</a>. This bookmarklet avoids this redirect. At the time of this writing, there is also a bug that causes these websites to hang on the first repeat (possibly <a href="https://code.google.com/p/gdata-issues/issues/detail?id=6531">this bug</a>?) on Flash videos. This script has a workaround for looping Flash videos on YouTube.</p>

<p><strong>How it works</strong>: Part of the script finds the video element in the page, and decides whether it's an HTML5 or Flash video. HTML5 videos have built-in support for looping: just enable the <code>loop</code> flag. Flash videos are looped using <code>setInterval</code> and the <a href="https://developers.google.com/youtube/iframe_api_reference">YouTube IFrame API</a> to check each second if the video has ended. When a Flash video has ended, the video is reloaded within the iframe through the YouTube API.</p>

<p><strong>But does it really work?</strong> I tested briefly with both Flash and HTML5 videos in Firefox (version 31.0). It supports HTML5 videos work in Chrome (version 37.0.2062.68). I couldn't figure out how to test Flash videos, since YouTube didn't let me play any videos with Flash. No idea if it works on any other browsers.</p>

<p><strong>Problems/Todo</strong></p>

<ul>
<li>It doesn't toggle looping off. After you click the bookmarklet to loop a video, you should pause the video if you want it to stop playing.</li>
<li>There is no indication that you've actually clicked the bookmark. Luckily the script is idempotent. You can click it as many times as you want to make sure the video loops.</li>
<li>I have no idea how this interacts with YouTube playlists.</li>
<li>It doesn't work for embedded YouTube videos. Doing this is a matter of finding the video in the page. </li>
</ul>
      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/pglass">pglass</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
    
  </body>
</html>
